server {
    listen 80;
    server_name your-domain.com;  # 修改为你的域名
    root /var/www/dice-game;      # 修改为你的静态文件路径
    index index.html;

    # 前端静态文件
    location / {
        try_files $uri $uri.html $uri/ /index.html;
    }

    # API 反向代理到后端
    # 前端请求 /api/backend/* 会被代理到后端服务器
    location /api/backend/ {
        # 后端 API 地址 - 修改为你的后端地址
        proxy_pass http://46.250.168.177:8079/api/backend/;
        
        # 代理头设置
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 转发 Telegram 认证头
        proxy_set_header initData $http_initdata;
        
        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # 禁用缓存 API 响应
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 静态资源缓存（JS、CSS、图片等）
    location /_next/static {
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # 禁用缓存 HTML 文件
    location ~* \.html$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 其他静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        add_header Cache-Control "public, max-age=31536000, immutable";
    }
}

# HTTPS 配置（推荐）
# server {
#     listen 443 ssl http2;
#     server_name your-domain.com;
#     root /var/www/dice-game;
#     index index.html;
#
#     ssl_certificate /path/to/your/certificate.crt;
#     ssl_certificate_key /path/to/your/private.key;
#
#     # 其他配置同上...
# }
#
# # HTTP 重定向到 HTTPS
# server {
#     listen 80;
#     server_name your-domain.com;
#     return 301 https://$server_name$request_uri;
# }