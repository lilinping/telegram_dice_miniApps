# 走势图优化更新

## 更新内容

优化了历史记录页面的"大小走势"图表，使其更加清晰和美观。

## 主要改进

### 1. 图表结构优化

**之前的问题**:
- 柱状图高度计算不准确，导致柱子太矮或看不见
- 缺少Y轴刻度，难以判断点数
- 缺少数值标签，不够直观

**现在的实现**:
```typescript
// 高度映射：将3-18点映射到0-100%
const heightPercent = ((analysis.total - 3) / 15) * 100;

// 确保最小高度可见
style={{ 
  height: `${Math.max(heightPercent, 5)}%`,
  minHeight: '20px'
}}
```

### 2. 新增功能

#### Y轴刻度线
```typescript
{[18, 15, 12, 9, 6, 3].map((value) => (
  <div key={value} className="flex items-center">
    <span className="text-xs text-text-disabled w-6">{value}</span>
    <div className="flex-1 h-px bg-border ml-2" />
  </div>
))}
```

#### 点数标签
每个柱子顶部显示具体点数（3-18）

#### 大小标签
每个柱子上方显示"大"、"小"或"豹"

#### 图例说明
底部显示颜色图例：
- 🔴 红色 = 大 (11-17)
- 🔵 蓝色 = 小 (4-10)
- 🟣 紫色 = 豹子（三同号）

### 3. 视觉优化

#### 渐变色彩
```typescript
className={cn(
  'w-full rounded-t transition-all relative',
  analysis.isTriple
    ? 'bg-gradient-to-t from-purple-600 to-purple-400'  // 豹子：紫色渐变
    : analysis.isBig
    ? 'bg-gradient-to-t from-error to-red-400'          // 大：红色渐变
    : 'bg-gradient-to-t from-info to-blue-400'          // 小：蓝色渐变
)}
```

#### 布局改进
- 图表高度增加到 `h-48`（192px）
- 柱子宽度固定为 `28px`
- 柱子间距 `gap-1`
- 支持横向滚动查看更多数据

#### 数据顺序
```typescript
historyData.slice(0, 20).reverse()
```
- 显示最近20局（而不是50局，避免过于拥挤）
- 反转顺序，最新的在右边

## 图表布局

```
┌─────────────────────────────────────────┐
│ 大小走势（近20局）                        │
├─────────────────────────────────────────┤
│ 18 ─────────────────────────────────── │
│ 15 ─────────────────────────────────── │
│ 12 ─────────────────────────────────── │
│  9 ─────────────────────────────────── │
│  6 ─────────────────────────────────── │
│  3 ─────────────────────────────────── │
│                                         │
│     大  小  大  豹  小  大  小  大  小   │ ← 标签
│     15  8   13  6   9   14  7   12  10  │ ← 点数
│     ██  ██  ██  ██  ██  ██  ██  ██  ██  │ ← 柱子
│     1   2   3   4   5   6   7   8   9   │ ← 序号
├─────────────────────────────────────────┤
│ 🔴 大(11-17)  🔵 小(4-10)  🟣 豹子      │ ← 图例
└─────────────────────────────────────────┘
```

## 技术细节

### 1. 相对定位布局
```typescript
<div className="relative h-48 mb-8">
  {/* Y轴刻度 - absolute */}
  <div className="absolute inset-0">...</div>
  
  {/* 柱状图 - absolute */}
  <div className="absolute inset-0 pl-8">...</div>
</div>
```

### 2. 高度计算
```typescript
// 点数范围：3-18（共15个值）
// 映射到：0-100%
const heightPercent = ((analysis.total - 3) / 15) * 100;

// 示例：
// 点数3  → (3-3)/15 = 0%
// 点数10 → (10-3)/15 = 46.67%
// 点数18 → (18-3)/15 = 100%
```

### 3. 三同号特殊处理
```typescript
const analyzeDice = (dice: number[]) => {
  const isTriple = dice[0] === dice[1] && dice[1] === dice[2];
  
  // 三同号通杀大小
  if (isTriple) {
    return { 
      total, 
      isBig: false,    // 不算大
      isSmall: false,  // 不算小
      isOdd, 
      isEven, 
      isTriple: true 
    };
  }
  
  return { total, isBig, isSmall, isOdd, isEven, isTriple: false };
};
```

## 响应式设计

- 图表容器支持横向滚动（`overflow-x-auto`）
- 柱子宽度固定，确保在小屏幕上也清晰可见
- 文字大小适配移动端（`text-xs`）

## 颜色方案

| 类型 | 颜色 | Tailwind 类 |
|-----|------|------------|
| 大 | 红色渐变 | `from-error to-red-400` |
| 小 | 蓝色渐变 | `from-info to-blue-400` |
| 豹子 | 紫色渐变 | `from-purple-600 to-purple-400` |
| Y轴刻度 | 灰色 | `bg-border` |
| 文字 | 浅灰 | `text-text-disabled` |

## 用户体验改进

1. **一目了然**: 通过颜色快速识别大小
2. **精确数据**: 显示具体点数，不用猜测
3. **趋势明显**: 柱状图高度直观反映点数大小
4. **特殊标注**: 豹子用紫色突出显示
5. **图例说明**: 底部图例帮助理解颜色含义

## 测试建议

- [ ] 测试不同数据量（1局、10局、20局）
- [ ] 测试包含豹子的情况
- [ ] 测试横向滚动功能
- [ ] 测试在不同屏幕尺寸下的显示
- [ ] 验证点数和颜色的对应关系

## 效果对比

### 更新前
- ❌ 柱子几乎看不见
- ❌ 没有刻度参考
- ❌ 不知道具体点数
- ❌ 只有序号，信息不足

### 更新后
- ✅ 柱子高度明显，易于比较
- ✅ Y轴刻度清晰
- ✅ 显示具体点数
- ✅ 大小标签直观
- ✅ 渐变色彩美观
- ✅ 图例说明完整

## 总结

通过优化图表结构、添加刻度线、显示数值标签和使用渐变色彩，大小走势图现在更加清晰、美观和易用。用户可以快速了解最近20局的开奖趋势，帮助做出更好的投注决策。
