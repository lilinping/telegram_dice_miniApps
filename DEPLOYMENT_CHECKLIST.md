# éƒ¨ç½²æ£€æŸ¥æ¸…å•

## âœ… éƒ¨ç½²å‰æ£€æŸ¥

### 1. åç«¯ API è®¤è¯
- [ ] ç¡®è®¤åç«¯ API éœ€è¦ `initData` è¯·æ±‚å¤´
- [ ] å‰ç«¯å·²æ·»åŠ  `initData` è¯·æ±‚å¤´ï¼ˆåœ¨ `src/lib/api.ts` ä¸­ï¼‰
- [ ] API è·¯ç”±å·²é…ç½®è½¬å‘ `initData` è¯·æ±‚å¤´ï¼ˆåœ¨ `src/app/api/backend/[...path]/route.ts` ä¸­ï¼‰

### 2. ç¯å¢ƒå˜é‡é…ç½®
- [ ] åœ¨ Vercel Dashboard ä¸­è®¾ç½® `BACKEND_API_URL`
- [ ] åœ¨ Vercel Dashboard ä¸­è®¾ç½® `NEXT_PUBLIC_TELEGRAM_BOT_TOKEN`
- [ ] åœ¨ Vercel Dashboard ä¸­è®¾ç½® `NEXT_PUBLIC_USDT_TRC20_ADDRESS`

### 3. ä»£ç æ£€æŸ¥
- [ ] è¿è¡Œ `npm run build` ç¡®ä¿æ„å»ºæˆåŠŸ
- [ ] æ£€æŸ¥ TypeScript é”™è¯¯
- [ ] æ£€æŸ¥ ESLint è­¦å‘Š

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬
```bash
./deploy-vercel.sh
```

### æ–¹æ³• 2: æ‰‹åŠ¨éƒ¨ç½²
```bash
# 1. æ„å»ºé¡¹ç›®
npm run build

# 2. éƒ¨ç½²åˆ° Vercel
vercel --prod

# 3. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœè¿˜æ²¡è®¾ç½®ï¼‰
vercel env add BACKEND_API_URL production
vercel env add NEXT_PUBLIC_TELEGRAM_BOT_TOKEN production
vercel env add NEXT_PUBLIC_USDT_TRC20_ADDRESS production
```

## ğŸ§ª éƒ¨ç½²åæµ‹è¯•

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] åœ¨ Telegram ä¸­æ‰“å¼€ Mini App
- [ ] æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯æ˜¯å¦æ­£ç¡®åŠ è½½
- [ ] æ£€æŸ¥ä½™é¢æ˜¯å¦æ˜¾ç¤º

### 2. æ¸¸æˆåŠŸèƒ½æµ‹è¯•
- [ ] å¼€å§‹æ–°æ¸¸æˆ
- [ ] é€‰æ‹©ç­¹ç å¹¶ä¸‹æ³¨
- [ ] æŸ¥çœ‹å¼€å¥–ç»“æœ
- [ ] æ£€æŸ¥ä½™é¢å˜åŒ–

### 3. é’±åŒ…åŠŸèƒ½æµ‹è¯•
- [ ] æŸ¥çœ‹é’±åŒ…ä½™é¢
- [ ] æµ‹è¯•å……å€¼æµç¨‹
- [ ] æµ‹è¯•æç°æµç¨‹
- [ ] æŸ¥çœ‹äº¤æ˜“å†å²

### 4. API æµ‹è¯•
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œæ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼š

- [ ] æ‰€æœ‰ API è¯·æ±‚éƒ½é€šè¿‡ `/api/backend` ä»£ç†
- [ ] è¯·æ±‚å¤´åŒ…å« `initData`
- [ ] æ²¡æœ‰ 401 é”™è¯¯
- [ ] æ²¡æœ‰ CORS é”™è¯¯

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: 401 Unauthorized

**åŸå› **: ç¼ºå°‘ `initData` è¯·æ±‚å¤´

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿åœ¨ Telegram ä¸­æ‰“å¼€åº”ç”¨ï¼ˆä¸è¦ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼‰
2. æ£€æŸ¥ `src/lib/api.ts` ä¸­æ˜¯å¦æ­£ç¡®è·å– `initData`
3. æ£€æŸ¥ API è·¯ç”±æ˜¯å¦æ­£ç¡®è½¬å‘ `initData` è¯·æ±‚å¤´

**éªŒè¯**:
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
console.log(window.Telegram?.WebApp?.initData);
// åº”è¯¥è¾“å‡ºä¸€ä¸ªé•¿å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ undefined
```

### é—®é¢˜ 2: CORS é”™è¯¯

**åŸå› **: ç›´æ¥è®¿é—®åç«¯ APIï¼Œè€Œä¸æ˜¯é€šè¿‡ä»£ç†

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿æ‰€æœ‰ API è¯·æ±‚éƒ½ä½¿ç”¨ `/api/backend` å‰ç¼€
2. æ£€æŸ¥ `src/lib/api.ts` ä¸­çš„ `API_BASE_URL` é…ç½®
3. ä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ `http://46.250.168.177:8079`

### é—®é¢˜ 3: ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**åŸå› **: ä¿®æ”¹ç¯å¢ƒå˜é‡åæœªé‡æ–°éƒ¨ç½²

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°éƒ¨ç½²
vercel --prod

# æˆ–åœ¨ Vercel Dashboard ä¸­ç‚¹å‡» "Redeploy"
```

### é—®é¢˜ 4: å¼€å‘ç¯å¢ƒæ— æ³•æµ‹è¯•

**åŸå› **: æœ¬åœ°å¼€å‘æ—¶æ²¡æœ‰ Telegram WebApp ç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿå·¥å…·ï¼ˆå·²è‡ªåŠ¨å¯ç”¨ï¼‰
2. æˆ–ä½¿ç”¨ ngrok ç­‰å·¥å…·å°†æœ¬åœ°æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ï¼Œç„¶ååœ¨ Telegram ä¸­æµ‹è¯•

```bash
# ä½¿ç”¨ ngrok
ngrok http 3000

# å°† ngrok æä¾›çš„ URL è®¾ç½®ä¸º Telegram Bot çš„ Web App URL
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### Vercel Dashboard
1. **Functions æ—¥å¿—**: æŸ¥çœ‹ API è·¯ç”±çš„æ‰§è¡Œæ—¥å¿—
2. **Analytics**: æŸ¥çœ‹è®¿é—®ç»Ÿè®¡
3. **Speed Insights**: æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. **Network**: æŸ¥çœ‹ API è¯·æ±‚å’Œå“åº”
2. **Console**: æŸ¥çœ‹é”™è¯¯æ—¥å¿—
3. **Application > Local Storage**: æŸ¥çœ‹å­˜å‚¨çš„æ•°æ®

## ğŸ”’ å®‰å…¨æ£€æŸ¥

- [ ] ä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯
- [ ] ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨ API å¯†é’¥
- [ ] ç¡®ä¿ `initData` åœ¨åç«¯è¿›è¡ŒéªŒè¯
- [ ] å®šæœŸæ›´æ–°ä¾èµ–åŒ…

## ğŸ“ éƒ¨ç½²è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | éƒ¨ç½²è€… | å¤‡æ³¨ |
|------|------|--------|------|
| 2024-12-02 | 1.0.0 | - | åˆå§‹éƒ¨ç½²ï¼Œæ·»åŠ  initData è®¤è¯ |

## ğŸ”— ç›¸å…³é“¾æ¥

- [Vercel Dashboard](https://vercel.com/dashboard)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Telegram WebApp API](https://core.telegram.org/bots/webapps)
- [Next.js API Routes](https://nextjs.org/docs/api-routes/introduction)
