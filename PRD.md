# 产品需求文档（Product Requirements Document）

## 1. 产品概述

- **产品名称**：骰宝夺宝 / DiceTreasure
- **产品版本**：V1.0
- **产品定位**：Telegram生态内首款移动优先、高沉浸感的实时骰宝游戏，融合即时动画、社交互动与加密货币支付的轻度社交博彩体验
- **运行平台**：Telegram WebApp (基于Telegram内嵌WebView)
- **目标用户**：18-45岁、移动优先、熟悉Telegram、偏好即时互动与休闲博彩的全球用户
- **核心问题**：传统线上骰宝游戏体验割裂（需下载独立APP）、支付流程复杂、缺乏社交属性、动画效果单一，用户难以获得沉浸式、便捷、可信的游戏体验

## 2. 用户分析

| 用户类型 | 用户特征 | 核心需求 | 使用场景 | 痛点 |
|:--------:|:--------:|:--------:|:--------:|:--------:|
| 休闲娱乐玩家 | 18-35岁，移动端重度用户，碎片时间游戏 | 快速进入游戏、简单易懂、视觉刺激、小额投注 | 通勤途中、午休、等待时刷Telegram随手玩几局 | 传统APP下载麻烦、学习成本高 |
| 骰宝爱好者 | 25-45岁，熟悉骰宝玩法，追求策略与赔率 | 多样化投注选项、清晰赔率展示、历史走势分析 | 晚间休闲时段，进行多轮策略性投注 | 移动端操作不便、赔率不透明 |
| 加密货币用户 | 20-40岁，持有USDT/TON等加密货币 | 便捷的加密货币充值提现、资金安全、低手续费 | 使用加密资产进行娱乐投注，快速提现 | 法币支付受限、跨境支付复杂 |
| 社交玩家 | 18-35岁，喜欢分享与竞争 | 排行榜、邀请好友、中奖分享、实时聊天 | 与朋友PK投注成绩、分享大奖战绩 | 传统游戏缺乏社交互动 |

## 3. 页面架构

### 3.1 页面清单

| 页面名称 | 页面类型 | 核心功能 | 用户价值 | 用户入口 | 优先级 |
|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 启动欢迎页 | 流程页 | 品牌展示、快速加载、用户授权 | 建立品牌认知、流畅进入游戏 | Telegram打开小程序 | P0 |
| 游戏大厅（首页） | 主页 | 投注面板、开奖动画、余额显示、快捷充值 | 一站式游戏体验、快速下注 | 欢迎页后自动进入 | P0 |
| 钱包页面 | 功能页 | 余额明细、充值入口、提现管理、交易记录 | 资金管理、透明账目 | 底部导航栏「钱包」 | P0 |
| 充值页面 | 流程页 | 支付方式选择、金额输入、支付确认 | 便捷充值、多渠道支付 | 钱包页「充值」按钮 | P0 |
| 提现页面 | 流程页 | 提现金额、钱包地址、身份验证 | 快速提现、资金安全 | 钱包页「提现」按钮 | P0 |
| 历史记录页 | 功能页 | 投注历史、中奖记录、开奖结果查询 | 数据追溯、策略分析 | 底部导航栏「记录」 | P0 |
| 规则说明页 | 功能页 | 投注规则、赔率说明、交互式示例 | 降低学习成本、提升理解 | 游戏大厅「规则」按钮 | P0 |
| 排行榜页 | 功能页 | 日榜/周榜/总榜、中奖金额排名 | 激发竞争、社交炫耀 | 底部导航栏「排行」 | P1 |
| 个人中心 | 功能页 | 用户信息、设置、邀请好友、VIP权益 | 个性化管理、社交裂变 | 底部导航栏「我的」 | P1 |
| 邀请好友页 | 流程页 | 邀请链接、奖励规则、邀请记录 | 用户增长、获取奖励 | 个人中心「邀请好友」 | P1 |
| VIP中心页 | 功能页 | 等级权益、升级条件、专属福利 | 用户留存、付费转化 | 个人中心「VIP中心」 | P1 |

### 3.2 页面详细需求

#### 页面1：启动欢迎页

- **页面目标**：建立品牌第一印象，快速加载游戏资源，完成Telegram用户授权
- **核心功能**：
  - 品牌Logo与Slogan展示
  - 加载进度条（预加载游戏资源、3D动画库）
  - Telegram用户授权（获取用户ID、昵称、头像）
  - 首次用户新手引导提示
- **业务逻辑**：
  - 页面停留时间2-3秒（加载完成自动跳转）
  - 检测是否首次进入（localStorage标记），首次用户显示简短新手引导气泡
  - 授权失败提示并提供重试按钮
  - 加载失败显示错误提示与刷新选项
- **页面元素**：
  - 品牌Logo（居中、大尺寸）
  - 加载进度条（底部）
  - 背景动画（骰子轻微滚动、粒子效果）
  - 版本号（右下角小字）
- **交互逻辑**：
  - 自动获取Telegram.WebApp.initData进行用户身份验证
  - 加载完成后淡出过渡至游戏大厅
- **跳转逻辑**：
  - 加载完成 → 自动跳转至游戏大厅
  - 授权失败 → 停留在欢迎页，显示错误提示

---

#### 页面2：游戏大厅（首页）

- **页面目标**：提供完整的骰宝游戏体验，包括投注、开奖、余额管理的一站式操作
- **核心功能**：
  - 顶部信息栏：当前局号、倒计时、余额显示、快捷充值
  - 押注面板：多种投注选项的格子化布局，显示赔率
  - 3D骰盅动画：实时开奖的视觉呈现
  - 中奖高亮与奖金弹窗
  - 底部操作栏：确认下注、清空下注、历史走势
  - 实时消息流：最新中奖播报
- **业务逻辑**：
  - 下注阶段：倒计时30秒（可配置），用户可点击格子下注
  - 封盘阶段：倒计时归零，禁止下注，显示「开奖中」
  - 开奖阶段：3D骰子动画3-5秒，显示最终点数
  - 结算阶段：高亮中奖格子，弹窗显示奖金，更新余额
  - 下注限制：单格最小/最大限额、总下注额度限制
  - 余额不足时禁用下注并引导充值
- **页面元素**：
  - **顶部栏**（固定）：
    - 局号（左上）
    - 倒计时（居中，大字体，倒数5秒变红闪烁）
    - 余额（右上，金色图标+数字）
    - 充值按钮（绿色，快捷入口）
  - **骰盅展示区**（占屏1/3）：
    - 3D骰盅与骰子模型（WebGL/three.js）
    - 开奖动画（骰盅晃动、打开、骰子滚动定格）
    - 点数结果大图展示
  - **押注面板**（可滚动）：
    - 大/小格（11-17 / 4-10，赔率1:1）
    - 单/双格（赔率1:1）
    - 点数格（4-17，不同赔率，如4点60:1）
    - 任意三同号格（赔率30:1）
    - 指定三同号格（赔率180:1）
    - 两骰组合格（如1+2，赔率6:1）
    - 单骰号格（1-6，赔率1:1/2:1/3:1）
    - 每格显示：图标、名称、赔率、已下注金额
  - **底部操作栏**（固定）：
    - 筹码选择器（10/50/100/500/1000可滑动选择）
    - 确认下注按钮（大、醒目、橙色）
    - 清空按钮（灰色）
    - 历史走势按钮（弹窗展示）
  - **实时消息条**（顶部下方滚动）：
    - 「玩家***刚刚中奖XXX」
- **交互逻辑**：
  - 点击筹码选择器选择下注金额
  - 点击押注格子 → 弹出下注确认框（显示格子名称、赔率、下注金额、预期奖金）
  - 确认 → 格子上叠加筹码图标并显示已下注金额
  - 可重复点击同一格累加下注
  - 点击「确认下注」→ 提交所有下注至后端 → 扣减余额 → 等待开奖
  - 倒计时归零 → 禁止操作 → 骰盅动画开始
  - 动画结束 → 显示点数 → 高亮中奖格子（闪烁、粒子效果）
  - 中奖弹窗：「恭喜！获得XXX」，显示总奖金，可分享至Telegram
- **跳转逻辑**：
  - 点击余额 → 跳转至钱包页面
  - 点击充值按钮 → 跳转至充值页面
  - 点击规则按钮 → 打开规则说明页（弹窗或新页）
  - 点击历史走势 → 打开历史记录页

---

#### 页面3：钱包页面

- **页面目标**：让用户清晰了解资金状况，方便管理充值、提现和交易记录
- **核心功能**：
  - 余额总览（可用余额、冻结余额、赠送余额分类显示）
  - 充值入口（多种支付方式）
  - 提现入口（加密货币地址管理）
  - 交易记录列表（充值、提现、下注、中奖分类筛选）
- **业务逻辑**：
  - 余额实时从后端获取，前端只展示
  - 冻结余额 = 当前局已下注金额
  - 赠送余额可用于下注但不可提现
  - 交易记录分页加载（每页20条）
  - 提现需满足最小金额要求（如≥50 USDT）
  - 大额提现需KYC验证
- **页面元素**：
  - **余额卡片**（顶部大卡片）：
    - 可用余额（大字、金色）
    - 冻结余额（小字、灰色）
    - 赠送余额（小字、蓝色）
    - 背景渐变+图标装饰
  - **操作按钮区**：
    - 充值按钮（绿色、大）
    - 提现按钮（橙色、大）
  - **交易记录区**：
    - 筛选标签（全部/充值/提现/下注/中奖）
    - 记录列表：
      - 交易类型图标
      - 交易说明（如「充值」「下注-局号123」）
      - 金额（+绿色/-红色）
      - 时间戳
      - 状态（成功/处理中/失败）
    - 加载更多/上拉刷新
- **交互逻辑**：
  - 下拉刷新余额
  - 点击充值 → 跳转充值页
  - 点击提现 → 跳转提现页
  - 点击筛选标签 → 切换记录类型
  - 点击单条记录 → 展开详情（订单号、时间、状态、备注）
- **跳转逻辑**：
  - 充值按钮 → 充值页面
  - 提现按钮 → 提现页面
  - 返回按钮 → 游戏大厅

---

#### 页面4：充值页面

- **页面目标**：提供便捷、安全、多渠道的充值体验，降低充值门槛
- **核心功能**：
  - 充值金额选择（快捷金额+自定义）
  - 支付方式选择（加密货币/法币）
  - 支付流程引导与状态追踪
  - 充值优惠活动展示
- **业务逻辑**：
  - 加密货币充值：
    - 后端生成唯一充值地址或Payment ID
    - 用户转账至指定地址
    - 后端监听区块链确认（3-6个确认）
    - 确认后自动到账
  - 法币充值（如支持）：
    - 调用第三方支付SDK（Stripe/MoonPay）
    - 支付成功回调后端
    - 验签并更新余额
  - 充值金额范围：最小10 USDT，最大10000 USDT
  - 首充/大额充值赠送额外余额（营销活动）
- **页面元素**：
  - **金额选择区**：
    - 快捷金额按钮（10/50/100/500/1000 USDT）
    - 自定义输入框
    - 实际到账金额显示（含手续费说明）
  - **支付方式区**（单选）：
    - USDT (TRC20/ERC20)
    - TON
    - Apple Pay / Google Pay（法币，若支持）
    - 信用卡（法币，若支持）
  - **优惠活动横幅**：
    - 「首充送20%」「充值满500送50」
  - **支付按钮**（大、醒目）
- **交互逻辑**：
  - 选择金额 → 显示预计到账
  - 选择支付方式 → 显示对应说明（如「转账至以下地址」）
  - 点击支付 → 根据方式执行：
    - 加密货币：显示充值地址二维码+复制按钮+金额说明
    - 法币：跳转第三方支付页面或打开SDK
  - 支付中：显示等待动画「正在确认支付」
  - 支付成功：显示成功页+跳转选项（返回游戏/查看余额）
  - 支付失败：显示错误信息+重试按钮
- **跳转逻辑**：
  - 支付成功 → 提示页（可选返回游戏/钱包）
  - 取消支付 → 返回钱包页面

---

#### 页面5：提现页面

- **页面目标**：让用户安全、快速地将余额提现至个人钱包
- **核心功能**：
  - 提现金额输入
  - 提现地址管理（加密货币钱包地址）
  - 身份验证（KYC，大额提现）
  - 手续费与到账时间说明
  - 提现记录查询
- **业务逻辑**：
  - 最小提现金额：50 USDT
  - 提现手续费：固定费用（如5 USDT）或百分比（如2%）
  - 提现审核：
    - 小额（<1000 USDT）自动审核，2小时内到账
    - 大额（≥1000 USDT）人工审核，24小时内到账
  - KYC要求：
    - 首次提现需上传身份证+自拍
    - 大额提现需额外人工审核
  - 提现频次限制：每天最多3次
  - 风控规则：异常行为（频繁小额提现、充值后立即提现）触发人工审核
- **页面元素**：
  - **金额输入区**：
    - 提现金额输入框
    - 「全部提现」快捷按钮
    - 可提现余额显示（排除赠送余额）
    - 手续费与实际到账金额实时计算
  - **地址管理区**：
    - 已保存地址列表（单选）
    - 添加新地址按钮（弹窗输入）
    - 地址备注（如「我的Trust Wallet」）
  - **验证区**（大额提现显示）：
    - KYC状态（已认证/待认证）
    - 认证入口
  - **说明区**：
    - 提现规则（最小金额、手续费、到账时间）
    - 安全提示
  - **提现按钮**（大、橙色）
- **交互逻辑**：
  - 输入金额 → 实时计算手续费与到账金额
  - 点击全部提现 → 自动填入最大可提现金额
  - 选择/添加地址 → 验证地址格式（前端正则+后端验证）
  - 点击提现 → 弹窗确认（显示金额、地址、手续费）
  - 确认 → 后端创建提现订单 → 显示提交成功页
  - 成功页：「提现申请已提交，预计XX小时到账」+查看记录按钮
- **跳转逻辑**：
  - 提交成功 → 提示页（可选返回钱包/查看提现记录）
  - 取消 → 返回钱包页面

---

#### 页面6：历史记录页

- **页面目标**：让用户查看过往投注、开奖结果，辅助策略分析
- **核心功能**：
  - 投注历史列表（局号、下注内容、结果、盈亏）
  - 开奖结果历史（近100局）
  - 走势图（大小、单双热度）
  - 筛选与搜索（按日期、结果类型）
- **业务逻辑**：
  - 显示最近100局记录（可配置）
  - 支持按日期范围筛选
  - 支持按结果筛选（仅中奖/仅未中奖/全部）
  - 走势图统计近50局大小、单双出现频率
- **页面元素**：
  - **标签页切换**：
    - 我的投注
    - 开奖历史
    - 走势分析
  - **我的投注页**：
    - 列表项：
      - 局号（如「#123456」）
      - 投注内容（如「大(1:1) 100USDT」）
      - 开奖结果（点数+骰子图标）
      - 盈亏（+绿色/-红色，未开奖显示「等待中」）
      - 时间戳
    - 筛选按钮（弹窗选择日期范围）
  - **开奖历史页**：
    - 时间轴列表：
      - 局号
      - 开奖结果（三颗骰子点数+总点数）
      - 大小/单双标签
      - 时间
    - 搜索框（按局号搜索）
  - **走势分析页**：
    - 大小柱状图（近50局）
    - 单双饼图
    - 热号冷号列表（1-6点出现频率）
- **交互逻辑**：
  - 切换标签页展示不同内容
  - 下拉刷新更新最新记录
  - 上拉加载更多历史
  - 点击单条投注 → 展开详情（下注明细、赔率计算）
  - 走势图可交互（点击查看具体局号）
- **跳转逻辑**：
  - 点击局号 → 显示该局详细信息弹窗
  - 返回 → 游戏大厅

---

#### 页面7：规则说明页

- **页面目标**：降低新用户学习成本，清晰说明投注规则与赔率
- **核心功能**：
  - 图文并茂的规则说明
  - 交互式赔率示例
  - 常见问题解答
  - 视频教程（可选）
- **业务逻辑**：
  - 分模块展示规则（基础规则、投注类型、赔率说明、特殊玩法）
  - 可点击投注类型查看详细说明与示例
- **页面元素**：
  - **导航目录**（侧边或顶部）：
    - 游戏介绍
    - 投注类型
    - 赔率说明
    - 常见问题
  - **内容区**（可滚动）：
    - **游戏介绍**：
      - 骰宝基本规则（三颗骰子、点数范围）
      - 游戏流程（下注→封盘→开奖→结算）
    - **投注类型**（卡片化展示）：
      - 大小（图示+说明+赔率）
      - 单双
      - 点数投注（4-17）
      - 任意三同号
      - 指定三同号
      - 两骰组合
      - 单骰号
      - 每种类型配示例：「下注100，开出结果X，获得Y」
    - **赔率表格**：
      - 清晰列出所有投注项与对应赔率
    - **常见问题**：
      - 如何充值？
      - 最小/最大下注是多少？
      - 开奖随机性如何保证？
      - 如何提现？
  - **视频教程按钮**（可选）
- **交互逻辑**：
  - 点击目录 → 跳转至对应章节
  - 点击投注类型卡片 → 展开详细说明
  - 点击示例 → 高亮计算过程
- **跳转逻辑**：
  - 关闭/返回 → 游戏大厅

---

#### 页面8：排行榜页（P1）

- **页面目标**：激发用户竞争欲，增强社交属性与用户粘性
- **核心功能**：
  - 日榜/周榜/总榜切换
  - 中奖金额排名
  - 用户昵称与头像展示（可匿名）
  - 自己的排名高亮
- **业务逻辑**：
  - 日榜：当日中奖总额排名（每日0点重置）
  - 周榜：本周中奖总额排名（每周一0点重置）
  - 总榜：累计中奖总额排名（不重置）
  - 显示前100名
  - 自己的排名单独显示（即使不在前100）
- **页面元素**：
  - **标签页切换**：日榜/周榜/总榜
  - **排行列表**：
    - 排名序号（前三名金银铜图标）
    - 用户头像（Telegram头像）
    - 用户昵称（可设置匿名显示「神秘玩家***」）
    - 中奖金额（大字、金色）
  - **我的排名卡片**（固定在底部）：
    - 当前排名
    - 中奖金额
    - 距离上一名差距
- **交互逻辑**：
  - 切换标签刷新数据
  - 下拉刷新排行榜
  - 点击排行项 → 显示该用户部分信息（可邀请好友功能）
- **跳转逻辑**：
  - 返回 → 游戏大厅

---

#### 页面9：个人中心（P1）

- **页面目标**：提供个性化管理、设置与社交功能入口
- **核心功能**：
  - 用户信息展示与编辑
  - 邀请好友
  - VIP权益查看
  - 设置（语言、音效、隐私）
  - 客服入口
  - 退出登录
- **业务逻辑**：
  - 用户信息从Telegram获取（头像、昵称、ID）
  - 可设置游戏内昵称（用于排行榜显示）
  - VIP等级根据充值总额/投注总额计算
  - 邀请好友成功可获得佣金或赠送余额
- **页面元素**：
  - **头部卡片**：
    - 用户头像
    - 昵称
    - Telegram ID
    - VIP等级图标
  - **功能入口列表**：
    - 邀请好友（右侧显示已邀请人数）
    - VIP中心（右侧显示当前等级）
    - 设置
    - 客服中心
    - 关于我们
    - 退出登录
  - **统计数据卡片**：
    - 累计投注额
    - 累计中奖额
    - 胜率
- **交互逻辑**：
  - 点击头像 → 查看/编辑个人信息
  - 点击功能入口 → 跳转对应页面
  - 点击退出 → 确认弹窗 → 清空本地缓存 → 返回欢迎页
- **跳转逻辑**：
  - 邀请好友 → 邀请好友页
  - VIP中心 → VIP中心页
  - 设置 → 设置页（弹窗或新页）
  - 客服 → Telegram客服聊天或客服页

---

#### 页面10：邀请好友页（P1）

- **页面目标**：通过社交裂变实现用户增长
- **核心功能**：
  - 生成专属邀请链接
  - 显示邀请奖励规则
  - 邀请记录与佣金统计
  - 一键分享至Telegram
- **业务逻辑**：
  - 邀请链接格式：`t.me/YourBot?start=invite_USER_ID`
  - 新用户通过链接注册并首充，邀请人获得奖励（如10%佣金或固定金额）
  - 邀请记录显示：好友昵称、注册时间、是否充值、获得奖励
- **页面元素**：
  - **邀请卡片**：
    - 专属邀请码
    - 邀请链接（可复制）
    - 二维码（可保存图片）
  - **奖励规则**：
    - 图文说明（如「好友首充，你得10%」）
  - **统计数据**：
    - 已邀请人数
    - 成功充值人数
    - 累计获得奖励
  - **邀请记录列表**：
    - 好友昵称（匿名显示）
    - 注册时间
    - 状态（已充值/未充值）
    - 获得奖励金额
  - **分享按钮**（大、醒目）
- **交互逻辑**：
  - 点击复制链接 → Toast提示「已复制」
  - 点击分享 → 调用Telegram分享API，预填邀请文案
  - 下拉刷新邀请记录
- **跳转逻辑**：
  - 返回 → 个人中心

---

#### 页面11：VIP中心页（P1）

- **页面目标**：展示VIP权益，激励用户充值升级
- **核心功能**：
  - VIP等级体系展示
  - 当前等级与进度
  - 各等级专属权益
  - 升级条件说明
- **业务逻辑**：
  - VIP等级：普通→青铜→白银→黄金→铂金→钻石（6级）
  - 升级条件：累计充值金额或累计投注额
  - 权益差异：
    - 提现手续费折扣（普通2%→钻石0.5%）
    - 单次下注限额提升
    - 专属客服
    - 生日礼金
    - 每日签到奖励倍数
- **页面元素**：
  - **当前等级卡片**：
    - 等级图标
    - 等级名称
    - 进度条（距离下一等级）
    - 升级所需金额
  - **权益对比表**：
    - 表格展示各等级权益对比
    - 当前等级高亮
  - **升级按钮**（引导充值）
- **交互逻辑**：
  - 点击等级图标 → 展开该等级详细权益
  - 点击升级按钮 → 跳转充值页
- **跳转逻辑**：
  - 升级按钮 → 充值页面
  - 返回 → 个人中心

---

## 4. 用户故事

### P0核心功能

#### 故事1：快速进入游戏
- **用户角色**：休闲娱乐玩家
- **功能描述**：在Telegram内点击小程序链接，2秒内完成加载并进入游戏大厅
- **用户价值**：无需下载APP，随时随地快速开始游戏
- **业务规则**：
  - 启动页加载时间≤3秒
  - 自动获取Telegram用户信息（无需额外注册）
  - 首次用户显示简短引导（可跳过）
  - 加载失败显示友好错误提示并提供重试

#### 故事2：简单易懂的投注体验
- **用户角色**：骰宝新手玩家
- **功能描述**：在押注面板上看到清晰的图标、名称、赔率，点击格子弹出下注确认，轻松完成首次投注
- **用户价值**：降低学习成本,即使不了解骰宝也能快速上手
- **业务规则**：
  - 每个投注格显示：图标+名称+赔率
  - 点击格子弹出确认框，显示预期奖金
  - 下注前可点击「规则」按钮查看详细说明
  - 首次下注后显示鼓励提示（如「干得好！等待开奖吧」）

#### 故事3：沉浸式开奖动画
- **用户角色**：追求视觉体验的玩家
- **功能描述**：下注后观看3D骰盅晃动、打开、骰子滚动的完整动画，配合音效与震动反馈，最终看到结果与中奖高亮
- **用户价值**：获得媲美真实赌场的沉浸感与刺激感
- **业务规则**：
  - 开奖动画时长3-5秒（可在设置中调整或关闭）
  - 使用WebGL/three.js渲染3D骰子
  - 配合音效：骰盅晃动声、骰子碰撞声、开奖音效
  - 中奖格子高亮+粒子爆炸效果
  - 大奖（>1000 USDT）触发特殊动画（如金币雨）

#### 故事4：便捷的加密货币充值
- **用户角色**：持有USDT的加密货币用户
- **功能描述**：点击充值按钮，选择USDT (TRC20)，输入金额100，获得充值地址二维码，转账后2分钟内到账
- **用户价值**：无需法币兑换，直接使用加密资产，到账快速
- **业务规则**：
  - 支持USDT (TRC20/ERC20)、TON
  - 后端生成唯一充值地址或Payment ID
  - 显示充值地址二维码+复制按钮
  - 区块链确认后自动到账（3-6个确认）
  - 到账后推送Telegram通知
  - 最小充值金额10 USDT

#### 故事5：余额实时更新
- **用户角色**：所有玩家
- **功能描述**：下注后余额立即扣减并显示冻结金额，开奖后中奖金额立即到账，余额实时刷新
- **用户价值**：资金透明可控，实时掌握账户状态
- **业务规则**：
  - 下注时：可用余额减少，冻结余额增加
  - 开奖后：冻结余额清零，中奖金额加入可用余额
  - 余额变动推送实时通知
  - 余额计算全部在后端完成，前端只展示
  - 提供交易明细供随时查询

#### 故事6：查看投注历史
- **用户角色**：策略型玩家
- **功能描述**：打开历史记录页，查看近100局的投注内容、开奖结果、盈亏情况，分析走势图
- **用户价值**：总结经验,优化投注策略
- **业务规则**：
  - 显示近100局投注记录
  - 可按日期、结果类型筛选
  - 走势图统计大小、单双、热号冷号
  - 支持按局号搜索

#### 故事7：安全提现
- **用户角色**：赢钱玩家
- **功能描述**：在钱包页点击提现，输入金额500 USDT和钱包地址，完成KYC验证，提交后24小时内到账
- **用户价值**：赢得的资金能安全、快速提取到个人钱包
- **业务规则**：
  - 最小提现金额50 USDT
  - 手续费：小额固定5 USDT，大额2%
  - 小额自动审核（2小时），大额人工审核（24小时）
  - 首次提现需KYC（上传身份证+自拍）
  - 每日提现限额3次
  - 风控规则：异常行为触发人工审核

### P1重要功能

#### 故事8：查看排行榜与竞争
- **用户角色**：社交玩家
- **功能描述**：打开排行榜，看到本周中奖金额前10名，发现自己排名第15，努力冲击前10
- **用户价值**：激发竞争欲，增加游戏粘性
- **业务规则**：
  - 日榜/周榜/总榜三种维度
  - 显示前100名
  - 自己的排名单独显示
  - 可匿名显示昵称
  - 实时更新

#### 故事9：邀请好友获得奖励
- **用户角色**：活跃用户
- **功能描述**：生成专属邀请链接分享至Telegram群组，好友注册并首充100 USDT后，自己获得10 USDT奖励
- **用户价值**：通过社交分享获得额外收益
- **业务规则**：
  - 邀请链接格式：`t.me/YourBot?start=invite_USER_ID`
  - 好友首充后邀请人获得10%佣金或固定奖励
  - 显示邀请记录与统计
  - 奖励实时到账

#### 故事10：VIP升级享受特权
- **用户角色**：高价值用户
- **功能描述**：累计充值达到5000 USDT，升级至黄金VIP，享受提现0手续费、专属客服、每日签到奖励翻倍
- **用户价值**：充值越多,享受的服务越好,提升尊贵感
- **业务规则**：
  - 6级VIP体系（普通→钻石）
  - 根据累计充值或投注额升级
  - 权益包括：手续费折扣、限额提升、专属客服、生日礼金、签到倍数
  - 降级机制（可选）：长期不活跃降级

---

## 5. 用户流程

### 主要操作路径

#### 新用户首次游戏流程
1. **Telegram打开小程序** → 2. **欢迎页加载** → 3. **自动授权** → 4. **进入游戏大厅** → 5. **查看规则（可选）** → 6. **点击充值** → 7. **选择USDT充值100** → 8. **转账至充值地址** → 9. **等待到账** → 10. **返回游戏大厅** → 11. **选择筹码10** → 12. **点击"大"格子下注** → 13. **确认下注** → 14. **等待倒计时** → 15. **观看开奖动画** → 16. **查看结果（中奖/未中奖）** → 17. **继续下注或查看余额**

#### 老用户快速游戏流程
1. **打开小程序** → 2. **直接进入游戏大厅** → 3. **查看当前局倒计时** → 4. **快速选择筹码并多格下注** → 5. **确认下注** → 6. **观看开奖** → 7. **中奖后继续下一局**

#### 充值流程
1. **游戏大厅点击充值** → 2. **选择金额（如500 USDT）** → 3. **选择支付方式（USDT TRC20）** → 4. **显示充值地址二维码** → 5. **复制地址至钱包转账** → 6. **页面显示"等待确认"** → 7. **3-6个区块确认后到账** → 8. **收到到账通知** → 9. **返回游戏**

#### 提现流程
1. **钱包页点击提现** → 2. **输入金额（如1000 USDT）** → 3. **选择/添加钱包地址** → 4. **完成KYC验证（首次）** → 5. **确认提现信息** → 6. **提交申请** → 7. **显示"已提交，24小时内到账"** → 8. **后台人工审核** → 9. **审核通过,转账至用户钱包** → 10. **收到到账通知**

### 页面流转图

```
启动欢迎页
    ↓
游戏大厅（首页）
    ├─→ 钱包页面
    │     ├─→ 充值页面 → 充值成功页 → 返回游戏大厅
    │     ├─→ 提现页面 → 提现申请成功页 → 返回钱包
    │     └─→ 交易记录详情（弹窗）
    ├─→ 历史记录页
    │     └─→ 局详情弹窗
    ├─→ 规则说明页（弹窗/新页）
    ├─→ 排行榜页（底部导航）
    └─→ 个人中心（底部导航）
          ├─→ 邀请好友页
          ├─→ VIP中心页 → 充值页面
          ├─→ 设置页
          └─→ 客服页
```

---

## 6. 功能优先级与MVP范围

### P0功能（MVP必做）
| 功能模块 | 具体功能 | 价值 |
|:--------:|:--------:|:--------:|
| 用户系统 | Telegram授权登录、用户ID绑定 | 用户身份基础 |
| 游戏大厅 | 投注面板、倒计时、余额显示 | 核心游戏体验 |
| 投注系统 | 多种投注类型、赔率展示、下注确认 | 游戏玩法核心 |
| 开奖系统 | 3D骰子动画、结果展示、中奖高亮 | 沉浸式体验 |
| 钱包系统 | 余额管理、交易记录 | 资金透明 |
| 充值功能 | USDT充值、充值地址生成、到账监控 | 资金流入 |
| 提现功能 | 提现申请、地址管理、KYC验证 | 资金流出 |
| 历史记录 | 投注历史、开奖历史 | 数据追溯 |
| 规则说明 | 图文规则、赔率表 | 降低门槛 |
| 后端基础 | RNG随机数、余额计算、订单管理、风控 | 系统可信度 |

### P1功能（V1.1迭代）
| 功能模块 | 具体功能 | 价值 |
|:--------:|:--------:|:--------:|
| 排行榜 | 日榜/周榜/总榜、排名展示 | 社交竞争 |
| 邀请系统 | 邀请链接、奖励发放、邀请记录 | 用户增长 |
| VIP系统 | 等级体系、权益展示、升级激励 | 付费转化 |
| 走势分析 | 大小单双走势图、热号统计 | 策略辅助 |
| 个人中心 | 信息管理、设置 | 个性化 |

### P2功能（V2.0远期规划）
| 功能模块 | 具体功能 | 价值 |
|:--------:|:--------:|:--------:|
| 聊天室 | 实时聊天、表情、举报 | 社交互动 |
| 任务系统 | 每日任务、成就勋章 | 用户留存 |
| 真人直播 | Live Dealer骰宝 | 高端体验 |
| 多语言 | 英语、中文、俄语等 | 国际化 |
| 皮肤商城 | 骰子皮肤、赌桌主题 | 个性化收入 |

---

## 7. 技术架构与实现要点

### 7.1 前端技术栈
- **框架**：React 18 / Next.js 14（支持SSR优化首屏加载）
- **状态管理**：Zustand / Redux Toolkit
- **样式**：Tailwind CSS + CSS Modules
- **3D动画**：Three.js / Babylon.js（骰子渲染）
- **动画库**：Lottie（UI动效）、GSAP（过渡动画）
- **Telegram集成**：Telegram WebApp SDK
- **区块链**：TON Connect v2（TON钱包连接）
- **支付SDK**：MoonPay（法币充值，可选）

### 7.2 后端技术栈
- **语言**：Node.js (Express/Nest.js) 或 Go
- **数据库**：PostgreSQL（用户、订单、交易）+ Redis（缓存、实时数据）
- **随机数**：Provably Fair算法（SHA-256哈希链）或硬件RNG
- **支付集成**：
  - 加密货币：Tatum API / TronGrid（监听USDT转账）
  - 法币：Stripe / MoonPay
- **区块链节点**：TON节点 / TronGrid API
- **消息队列**：RabbitMQ / Kafka（处理充值回调）
- **监控**：Sentry（错误追踪）、Prometheus + Grafana（性能监控）

### 7.3 核心技术实现

#### 3D骰子动画
- **技术选型**：Three.js
- **实现方案**：
  - 创建3D骰子模型（6面体，每面贴图1-6点）
  - 物理引擎（Cannon.js）模拟重力、碰撞、摩擦
  - 动画流程：骰盅晃动 → 骰子抛出 → 滚动碰撞 → 逐渐静止 → 定格结果
  - 后端预先计算结果，前端动画反向推导骰子初始速度与角度
  - 优化：低端设备降级为2D Lottie动画

#### Provably Fair随机数
- **目的**：让用户验证开奖的公平性
- **实现方案**：
  - 服务端生成随机种子（Server Seed）并哈希（SHA-256）
  - 用户提供客户端种子（Client Seed，可自定义）
  - 下注时公开哈希值，开奖后公开原始种子
  - 用户可用公开的种子重新计算结果验证
- **优势**：透明、可审计、增强信任

#### 充值监控（USDT TRC20）
- **流程**：
  1. 用户发起充值 → 后端生成唯一Payment ID与充值地址
  2. 后端定时轮询TronGrid API查询该地址的USDT转账
  3. 检测到转账 → 验证金额、memo → 更新订单状态为「确认中」
  4. 等待3-6个区块确认 → 标记订单「已完成」→ 增加用户余额
  5. 推送Telegram通知
- **异常处理**：
  - 金额不符 → 人工介入
  - 超时未到账 → 提示用户联系客服

#### 风控系统
- **规则引擎**：
  - 单用户单日最大下注额限制
  - 单局多格下注总额限制（防套利）
  - 异常充值提现行为（充值后立即提现、频繁小额）
  - IP/设备指纹检测（防刷单）
- **处理策略**：
  - 轻度风险：限额、延长提现审核
  - 中度风险：冻结账户、人工审核
  - 重度风险：永久封禁

### 7.4 性能优化
- **首屏加载**：
  - 服务端渲染（SSR）核心页面
  - 3D资源懒加载（仅在开奖时加载Three.js）
  - 图片压缩与WebP格式
  - CDN加速静态资源
- **实时性**：
  - WebSocket推送开奖结果（而非轮询）
  - Redis缓存用户余额、当前局信息
- **移动端优化**：
  - 触摸优化（大按钮、防误触）
  - 减少HTTP请求（合并资源）
  - 骨架屏占位

---

## 8. 投注规则与赔率体系

### 8.1 投注类型与赔率

| 投注类型 | 说明 | 赔率 | 最小下注 | 最大下注 |
|:--------:|:--------:|:--------:|:--------:|:--------:|
| 大（Big） | 总点数11-17（非三同号） | 1:1 | 10 | 10000 |
| 小（Small） | 总点数4-10（非三同号） | 1:1 | 10 | 10000 |
| 单（Odd） | 总点数为奇数 | 1:1 | 10 | 10000 |
| 双（Even） | 总点数为偶数 | 1:1 | 10 | 10000 |
| 点数4 | 总点数为4 | 60:1 | 1 | 500 |
| 点数5 | 总点数为5 | 30:1 | 1 | 500 |
| 点数6 | 总点数为6 | 18:1 | 1 | 500 |
| 点数7 | 总点数为7 | 12:1 | 1 | 500 |
| 点数8 | 总点数为8 | 8:1 | 1 | 500 |
| 点数9 | 总点数为9 | 7:1 | 1 | 500 |
| 点数10 | 总点数为10 | 6:1 | 1 | 500 |
| 点数11 | 总点数为11 | 6:1 | 1 | 500 |
| 点数12 | 总点数为12 | 7:1 | 1 | 500 |
| 点数13 | 总点数为13 | 8:1 | 1 | 500 |
| 点数14 | 总点数为14 | 12:1 | 1 | 500 |
| 点数15 | 总点数为15 | 18:1 | 1 | 500 |
| 点数16 | 总点数为16 | 30:1 | 1 | 500 |
| 点数17 | 总点数为17 | 60:1 | 1 | 500 |
| 任意三同号 | 三颗骰子点数相同（任意） | 30:1 | 1 | 1000 |
| 指定三同号 | 指定某点的三同号（如三个6） | 180:1 | 1 | 100 |
| 两骰组合 | 指定两颗骰子点数（如1+2） | 6:1 | 1 | 1000 |
| 单骰号（1次） | 指定点数出现1次 | 1:1 | 1 | 1000 |
| 单骰号（2次） | 指定点数出现2次 | 2:1 | 1 | 500 |
| 单骰号（3次） | 指定点数出现3次 | 3:1 | 1 | 200 |

### 8.2 特殊规则
- **三同号通杀**：出现任意三同号时，大/小投注全部输（庄家优势）
- **多格投注**：用户可同时在多个格子下注
- **限额控制**：单局总下注额不超过用户余额，单格不超过最大限额
- **结算优先级**：开奖后立即结算，中奖金额实时到账

---

## 9. 数据监控与KPI

### 9.1 核心指标

| 指标类型 | 指标名称 | 目标值 | 监控频率 |
|:--------:|:--------:|:--------:|:--------:|
| 用户指标 | 日活用户（DAU） | 5000+ | 每日 |
| 用户指标 | 月活用户（MAU） | 20000+ | 每月 |
| 用户指标 | 留存率（次日/7日/30日） | 40%/20%/10% | 每日 |
| 付费指标 | 付费转化率 | 15%+ | 每日 |
| 付费指标 | ARPU（人均营收） | $10+ | 每月 |
| 付费指标 | ARPPU（付费用户人均营收） | $50+ | 每月 |
| 游戏指标 | 单用户平均局数/天 | 10+ | 每日 |
| 游戏指标 | 平均单局下注额 | $20+ | 每日 |
| 游戏指标 | 总投注额（GGR） | - | 每日 |
| 系统指标 | 页面加载时间 | <3秒 | 实时 |
| 系统指标 | API响应时间 | <500ms | 实时 |
| 系统指标 | 可用性（SLA） | 99.9%+ | 每月 |
| 支付指标 | 充值成功率 | 95%+ | 每日 |
| 支付指标 | 提现成功率 | 98%+ | 每日 |
| 支付指标 | 平均到账时间（充值） | <10分钟 | 每日 |

### 9.2 监控看板
- **实时大盘**：当前在线人数、当前局号、累计下注额、当前局下注人数
- **用户分析**：新增用户、活跃用户、付费用户、用户来源
- **财务分析**：充值金额、提现金额、平台盈利、手续费收入
- **游戏分析**：各投注类型占比、中奖率、热门投注格
- **异常监控**：充值失败订单、提现异常、风控触发记录

---

## 10. 商业模式与营收策略

### 10.1 营收来源
1. **平台抽水**：赔率内定（如大小赔率1:1实际概率>50%，平台期望收益率5-10%）
2. **充值手续费**：部分支付渠道收取1-3%手续费（或由平台承担）
3. **提现手续费**：固定费用（小额5 USDT）或百分比（大额2%）
4. **VIP会员费**：月费/年费制VIP权益
5. **广告收入**：非付费用户观看广告获得赠送余额（激励视频广告）
6. **品牌合作**：游戏内品牌露出、联名活动

### 10.2 成本结构
1. **开发成本**：前后端开发、UI/UX设计、测试
2. **服务器成本**：云服务器、CDN、区块链节点
3. **支付成本**：支付渠道手续费（3-5%）、区块链Gas费
4. **营销成本**：用户获取（CPA）、邀请奖励、首充优惠
5. **客服成本**：客服人员、KYC审核
6. **合规成本**：法律咨询、牌照费用（若需要）

### 10.3 盈利模型（示例）
- **假设**：日活5000人，付费率15%（750人），ARPPU $50/月
- **月营收**：750人 × $50 = $37,500
- **平台抽水**：假设5%期望收益率，月总投注额$500,000，抽水$25,000
- **手续费收入**：提现手续费约$2,000/月
- **总营收**：$37,500 + $25,000 + $2,000 = $64,500/月
- **成本**：服务器$2,000 + 支付手续费$3,000 + 营销$10,000 + 人力$15,000 = $30,000
- **净利润**：$64,500 - $30,000 = $34,500/月

---

## 11. 合规性与风险控制

### 11.1 合规要求
- **地域限制**：根据各国法律限制服务地区（如禁止美国、中国大陆用户）
- **年龄验证**：KYC验证用户年满18岁
- **牌照**：根据运营地区申请博彩牌照（如库拉索、马耳他）
- **反洗钱（AML）**：监控大额异常交易，要求KYC
- **数据隐私**：遵守GDPR、CCPA等数据保护法规
- **税务合规**：根据所在地缴纳税款

### 11.2 风险控制
- **技术风险**：
  - 随机数被破解 → 使用Provably Fair + 硬件RNG
  - 服务器宕机 → 多节点部署、自动故障转移
  - DDOS攻击 → Cloudflare防护
- **财务风险**：
  - 用户套利 → 风控规则限制
  - 支付渠道冻结 → 多渠道备份
  - 提现挤兑 → 设置提现限额与审核
- **法律风险**：
  - 被定性为非法赌博 → 合规运营、申请牌照
  - 用户投诉 → 透明规则、客服响应
- **运营风险**：
  - 用户流失 → 优化体验、增加留存机制
  - 恶意刷单 → IP/设备指纹检测

### 11.3 KYC流程
- **触发条件**：首次提现、单次充值>$1000、累计提现>$5000
- **验证内容**：
  - 身份证/护照照片
  - 手持证件自拍
  - 地址证明（可选）
- **审核时效**：24小时内
- **隐私保护**：数据加密存储、仅授权人员访问

---

## 12. 产品约束与边界

### 12.1 平台要求
- **运行环境**：Telegram WebApp（iOS/Android/Desktop Telegram客户端）
- **浏览器兼容**：支持WebView内Chromium内核（iOS Safari WebView、Android Chrome WebView）
- **网络要求**：稳定的3G/4G/5G/Wi-Fi连接
- **设备要求**：
  - 移动端：iOS 12+、Android 8+
  - 桌面端：Telegram Desktop最新版

### 12.2 功能边界
- **做什么**：
  - 骰宝游戏（单一游戏类型，V1.0不包含其他游戏）
  - 加密货币充值提现（USDT、TON）
  - 基础社交功能（排行榜、邀请）
- **不做什么**：
  - 真人直播（V1.0不包含）
  - 法币充值（可选，根据合规决定）
  - 多语言（V1.0仅英语，V2.0扩展）
  - 其他游戏类型（扑克、老虎机等，后续考虑）

### 12.3 内容规范
- **用户昵称**：禁止包含违法、色情、政治敏感词汇
- **聊天内容**（V2）：敏感词过滤、举报机制
- **宣传材料**：遵守Telegram社区规范，不发送垃圾消息

### 12.4 技术约束
- **3D动画**：低端设备自动降级为2D动画，确保流畅性
- **并发处理**：单局最大支持10,000并发下注
- **数据存储**：用户数据保留3年，交易记录永久保留
- **API限流**：单用户每秒最多10次请求

---

## 13. 上线计划与里程碑

### 13.1 开发阶段（12周）

| 阶段 | 周期 | 任务 | 交付物 |
|:--------:|:--------:|:--------:|:--------:|
| 需求确认 | Week 1 | PRD评审、原型设计、技术方案 | PRD终稿、原型图 |
| UI设计 | Week 2-3 | 视觉设计、动效设计、切图 | UI设计稿、设计规范 |
| 前端开发 | Week 4-7 | 页面开发、3D动画、Telegram集成 | 前端代码、演示版本 |
| 后端开发 | Week 4-8 | 用户系统、游戏逻辑、支付集成、风控 | 后端API、数据库 |
| 测试 | Week 9-10 | 功能测试、压力测试、安全测试 | 测试报告、Bug修复 |
| 上线准备 | Week 11-12 | 服务器部署、监控配置、合规审查 | 生产环境、运营手册 |

### 13.2 上线后运营

| 阶段 | 时间 | 目标 | 关键动作 |
|:--------:|:--------:|:--------:|:--------:|
| 内测 | Week 13 | 100内测用户，验证核心流程 | 邀请测试、收集反馈 |
| 公测 | Week 14-16 | 1000用户，优化体验 | Telegram群推广、首充优惠 |
| 正式运营 | Week 17+ | 5000+ DAU，实现盈利 | 营销投放、功能迭代 |

---

## 14. 附录

### 14.1 竞品分析总结
基于市场调研，2025年Telegram WebApp游戏生态蓬勃发展，关键趋势包括：
- **无缝体验**：用户无需下载APP，在Telegram内即点即玩
- **加密支付**：USDT、TON等加密货币成为主流支付方式
- **社交裂变**：邀请好友、排行榜等社交功能显著提升用户增长
- **AI个性化**：根据用户行为推荐投注策略（V2.0考虑）
- **Web3集成**：NFT、DeFi等元素融入游戏（长期规划）

### 14.2 关键技术参考
- **Telegram WebApp官方文档**：https://core.telegram.org/bots/webapps
- **TON Connect v2**：Telegram钱包连接SDK
- **Three.js**：3D图形库，用于骰子动画
- **Provably Fair**：可验证随机数算法
- **TronGrid API**：监听USDT (TRC20)转账

### 14.3 设计资源
- **Dribbble**：搜索「Sic Bo」「Casino Game」获取设计灵感
- **Lottie动画库**：LottieFiles.com（开奖动画、加载动画）
- **UI Kit**：Telegram WebApp UI Kit（遵循Telegram设计规范）

### 14.4 术语表
- **Sic Bo（骰宝）**：源自中国的骰子博彩游戏
- **RNG（Random Number Generator）**：随机数生成器
- **Provably Fair**：可验证公平性的随机算法
- **KYC（Know Your Customer）**：了解你的客户（身份验证）
- **GGR（Gross Gaming Revenue）**：总投注额
- **ARPU（Average Revenue Per User）**：人均营收
- **ARPPU（Average Revenue Per Paying User）**：付费用户人均营收
- **SLA（Service Level Agreement）**：服务水平协议

---

## 15. 更新日志

| 版本 | 日期 | 更新内容 | 负责人 |
|:--------:|:--------:|:--------:|:--------:|
| V1.0 | 2025-11-09 | 初版PRD，定义核心功能与MVP范围 | Product Manager |

---

**文档状态**：✅ 已完成
**下一步行动**：UI/UX设计师根据本PRD开始视觉设计与交互原型制作

---

*本文档为内部产品需求文档，包含商业敏感信息，请勿外传*
