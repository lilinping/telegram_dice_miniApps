# 筛盅 + 三颗骰子真实摇动效果  
## **需求方案（最终版，可直接用于当前项目开发）**

---

# 1. 背景说明  
当前项目已经有基本的骰宝/骰子类游戏业务，但动画表现较弱：  
- 骰子跳动不真实  
- 没有筛盅（Dice Shaker）  
- 缺乏“真实物理 + 玻璃反射 + 动态碰撞声效”

为提升用户体验，需要 **加入一个透明玻璃筛盅内三颗骰子真实摇动、碰撞、停稳的效果**。  

---

# 2. 目标效果（最终要呈现的体验）

### **2.1 整体体验流程：**
1. 用户点击“开始摇骰”
2. 玻璃筛盅盖上 → 内部三颗骰子高速旋转  
3. 筛盅圆周摇动（1～1.5秒）  
4. 筛盅落下，骰子弹跳  
5. 骰子自然停稳  
6. 筛盅缓慢抬起  
7. 展示后台指定点数（含物理校正）  

---

# 3. 需求细化

## 3.1 UI 模块需求
| 模块 | 要求 |
|------|------|
| 透明玻璃筛盅模型 | PBR 材质、折射、环境光反射 |
| 三颗骰子 | 3D 模型 + 真实物理碰撞 |
| 桌面背景 | 木质/皮革主题 |
| 动画系统 | 筛盅摇动动画 + 骰子物理动画 |
| 声效 | 摇盅摩擦声、骰子碰撞声、落地声 |

---

## 3.2 动画阶段拆解

### **① 盖盅：0.3s**
- 筛盅从上方快速盖下  
- 轻微玻璃颤动感  

### **② 摇盅：1.2–1.8s**
- 圆周轨迹随机  
- 加少量噪声（更真实）  
- 同步摩擦声  

### **③ 落盅：0.2s**
- 落下时骰子被带起  
- 播放重低频“砰”声  

### **④ 骰子自然物理停稳：1s**
- 完全由物理引擎控制  
- 随机弹跳/滚动  

### **⑤ 抬盅：1s**
- 平滑提起  
- 玻璃折射变化，让画面更高级  

### **⑥ 展示点数**
- 调用后台结果  
- 播放 Reveal 动效  

---

# 4. 与市面产品对比分析

## 4.1 PG SOFT（国际一线）
优点：  
- 动画高级  
- 材质真实  
- 物理自然  

我们目标需达成：  
✔ 真实摇盅  
✔ 真实骰子物理  
✔ PBR 光影  
✔ 抬盅展示效果  

---

## 4.2 Evolution Gaming 真人骰宝
亮点：  
- 顶级玻璃折射效果  
- 高级光照模型  

可借鉴：  
✔ 玻璃边缘 Fresnel  
✔ 透明度层级  
✔ HDRI 环境反射  

---

## 4.3 小程序常见骰宝（多数质量较差）
缺点：  
✘ 骰子是假旋转  
✘ 没有真实物理  
✘ 玻璃像塑料  
✘ 声音乏力  

本项目目标：  
**比国内小游戏质量高一个维度，接近国际厂商品质。**

---

# 5. 技术实现方案

## 5.1 3D 渲染方案
适配已有 React/WebGL 项目建议：

### **Three.js + Cannon-es（推荐）**
优点：  
- 性能好  
- 材质效果强  
- 工程可控  

玻璃筛盅材质：  
- MeshPhysicalMaterial  
- roughness = 0.1  
- ior = 1.45  
- transmission = 1  
- Fresnel Shader  

骰子：  
- 真实 Box 碰撞体  
- 六面贴图  
- 支持真实滚动  

---

## 5.2 动画方案

### **筛盅动画 → 补间动画（GSAP）**
优点：可精确控制轨迹和拟真效果。

示例轨迹：  
- 圆周路径  
- 噪声扰动  
- 随机偏移  

---

### **骰子动画 → 物理模拟（Cannon-es）**
流程：  
1. 给初始线速度 + 角速度  
2. 真实碰撞 → 滚动 → 减速  
3. 自然停下  

---

## 5.3 最终点数控制方案（核心能力）
业务需要与后台一致，所以需：

### **“真实模拟 + 姿态校正”双模式**
1. 物理模拟结束时取当前骰子姿态  
2. Backend 结果 = [x, y, z]  
3. 调整骰子旋转，使对应点数朝上  
4. 过渡动画：0.1s “微动”修正，使其不突兀  

---

# 6. 声效设计

### 需要三个声音：
| 声音 | 触发 |
|------|------|
| 摇盅摩擦声 | 摇盅阶段循环 |
| 骰子碰撞声 | 物理事件触发（设置阈值） |
| 筛盅落下声 | 落盅瞬间 |

---

# 7. 验收标准

### **画面**
- 玻璃真实性 ≥ PG SOFT 70%  
- 骰子停放位置随机、多样  
- 光影自然，不影响可视性  

### **动画**
- 摇盅流畅、不突兀  
- 骰子自然、不假  
- 抬盅节奏高级  

### **性能**
- 全程 60fps（主流机型）  
- 低配机可自动降级  

---

# 8. 状态机（简化版）

IDLE
→ START_SHAKE
→ COVER_DOWN
→ CUP_SHAKE
→ CUP_DROP
→ DICE_PHYSICS
→ RESULT_CORRECT
→ CUP_UP
→ RESULT_SHOW
→ IDL